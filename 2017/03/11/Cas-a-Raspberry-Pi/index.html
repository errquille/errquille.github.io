<!DOCTYPE html>
<html lang=cs>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="TerminologieV anglických textech se při popisu počítačových hodin objevují slova accuracy a resolution. Resolution, česky rozlišení, udává nejmenší díl, jehož změnu jsme schopni rozlišit. Accuracy, če">
<meta property="og:type" content="article">
<meta property="og:title" content="Čas a Raspberry Pi">
<meta property="og:url" content="http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/index.html">
<meta property="og:site_name" content="Studentský blog">
<meta property="og:description" content="TerminologieV anglických textech se při popisu počítačových hodin objevují slova accuracy a resolution. Resolution, česky rozlišení, udává nejmenší díl, jehož změnu jsme schopni rozlišit. Accuracy, če">
<meta property="og:image" content="http://errquille.github.io/img/accuracy-vs-precision.jpeg">
<meta property="og:updated_time" content="2017-03-24T03:06:04.231Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Čas a Raspberry Pi">
<meta name="twitter:description" content="TerminologieV anglických textech se při popisu počítačových hodin objevují slova accuracy a resolution. Resolution, česky rozlišení, udává nejmenší díl, jehož změnu jsme schopni rozlišit. Accuracy, če">
<meta name="twitter:image" content="http://errquille.github.io/img/accuracy-vs-precision.jpeg">
    
    
        
          
              <link rel="shortcut icon" href="/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
          
        
        
          <link rel="manifest" href="/manifest.json">
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
          
        
        
          <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        
    
    <!-- title -->
    <title>Čas a Raspberry Pi</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Studentský blog" type="application/atom+xml" />
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>
    
      <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Doma</a></li>
         
          <li><a href="/archives/">Články</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/03/13/Zprovozneni-linuxptp-na-Raspberry-Pi/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/03/01/Mereni-dopravniho-zpozdeni/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&text=Čas a Raspberry Pi"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&is_video=false&description=Čas a Raspberry Pi"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Čas a Raspberry Pi&body=Check out this article: http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&name=Čas a Raspberry Pi&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Terminologie"><span class="toc-number">1.</span> <span class="toc-text">Terminologie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STC"><span class="toc-number">2.</span> <span class="toc-text">STC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PTP"><span class="toc-number">3.</span> <span class="toc-text">PTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPS"><span class="toc-number">4.</span> <span class="toc-text">PPS</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Čas a Raspberry Pi
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Studentský blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-03-11T18:25:35.000Z" itemprop="datePublished">2017-03-11</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Terminologie"><a href="#Terminologie" class="headerlink" title="Terminologie"></a>Terminologie</h2><p>V anglických textech se při popisu počítačových hodin objevují slova accuracy a resolution. Resolution, česky rozlišení, udává nejmenší díl, jehož změnu jsme schopni rozlišit. Accuracy, česky přesnost, je rozdíl změřeného času oproti skutečnému času, tedy míra chyby. Skutečný čas je ale záležitost, kterou nikdy neměříme naprosto přesně, a tak nám k určení přesnosti stačí porovnání s hodinami, které jsou prokázány jako dostatečně dobré. Od přesnosti se také rozlišuje preciznost (precision). <img src="/img/accuracy-vs-precision.jpeg"> Rozdíl mezi nimi je, že preciznost udává míru statistické chyby, přesnost udává systematickou chybu.</p>
<h2 id="STC"><a href="#STC" class="headerlink" title="STC"></a>STC</h2><p>Raspberry Pi nemá RTC obvod, TSC ani HPET. Jako zdroj hodin používá vlastní softwareový čítač STC.<br><figure class="highlight c"><figcaption><span>STC v kernelu Raspberry</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* The STC is a free running counter that increments at the rate of 1MHz */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> STC_FREQ_HZ 1000000</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Constants generated by clocks_calc_mult_shift(m, s, 1MHz, NSEC_PER_SEC, 60).</div><div class="line"> * This gives a resolution of about 1us and a wrap period of about 1h11min.</div><div class="line"> */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_MULT		4194304000u</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SC_SHIFT	22</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> cycle_t <span class="title">stc_read_cycles</span><span class="params">(<span class="keyword">struct</span> clocksource *cs)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">/* STC: a free running counter that increments at the rate of 1MHz */</span></div><div class="line">	<span class="keyword">return</span> (<span class="keyword">cycle_t</span>) readl(__io_address(ST_BASE + <span class="number">0x04</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">struct</span> clocksource clocksource_stc = &#123;</div><div class="line">	.name = <span class="string">"stc"</span>,</div><div class="line">	.rating = <span class="number">300</span>,</div><div class="line">	.read = stc_read_cycles,</div><div class="line">	.mask = CLOCKSOURCE_MASK(<span class="number">32</span>),</div><div class="line">	.flags = CLOCK_SOURCE_IS_CONTINUOUS,</div><div class="line">&#125;;</div></pre></td></tr></table></figure><br>Tento čítač inkrementuje s frekvencí 1 MHz a má tedy rozlišení jedné mikrosekundy. Bez hardwareových hodin nemá z čeho být inicializován, a záleží tedy na synchronizaci k nastavení správného času a udržení vysoké přesnosti.</p>
<h2 id="PTP"><a href="#PTP" class="headerlink" title="PTP"></a>PTP</h2><p>PTP, precision time protocol, také známý jako IEEE 1588, je protokol k synchronizaci času mezi master zařízením a slave zařízením, podobně jako NTP. NTP je určeno k synchronizaci po internetu, a v lokální síti nedosahuje té nejvyšší přesnosti. To dalo prostor vzniku PTP, které si bere za cíl dosahovat vyšší přesnosti v lokálních sítích, potřebné pro řídící systémy, měřící systémy a systémy distribuce energie. Často bývá uváděná přesnost po synchronizaci pod jednu mikrosekundu. Pro systém Linux existují implementace PTP protokolu <a href="http://linuxptp.sourceforge.net/" target="_blank" rel="external">linuxptp</a> a <a href="https://github.com/ptpd/ptpd" target="_blank" rel="external">ptpd</a>.</p>
<h2 id="PPS"><a href="#PPS" class="headerlink" title="PPS"></a>PPS</h2><p>K porovnání a ověření, jaké přesnosti dosáhne synchronizace pomocí PTP, vyvedeme na jeden z výstupních pinů GPIO PPS signál. Poté na oscilátoru zjistíme, jaký posun mají mezi sebou hrany master a slave zařízení.</p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Doma</a></li>
         
          <li><a href="/archives/">Články</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Terminologie"><span class="toc-number">1.</span> <span class="toc-text">Terminologie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STC"><span class="toc-number">2.</span> <span class="toc-text">STC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PTP"><span class="toc-number">3.</span> <span class="toc-text">PTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPS"><span class="toc-number">4.</span> <span class="toc-text">PPS</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&text=Čas a Raspberry Pi"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&is_video=false&description=Čas a Raspberry Pi"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Čas a Raspberry Pi&body=Check out this article: http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&title=Čas a Raspberry Pi"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://errquille.github.io/2017/03/11/Cas-a-Raspberry-Pi/&name=Čas a Raspberry Pi&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 Šimon Wernisch
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Doma</a></li>
         
          <li><a href="/archives/">Články</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-92989814-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments --><!-- hexo-inject:begin --><!-- hexo-inject:end -->


</body>
</html>
